{% comment %}
  Theme Section: Shop The Look (Loro Piana White Edition)
  Description: White background, manual product images, smart navigation icons.
{% endcomment %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<div class="stl-section-wrapper" style="background-color: {{ section.settings.bg_color }}; color: {{ section.settings.text_color }};">
  
  <div class="stl-container">
    
    <div class="stl-left">
      <div class="stl-image-frame">
        {% if section.settings.model_image != blank %}
          <img 
            src="{{ section.settings.model_image | image_url: width: 1400 }}" 
            alt="The Look" 
            class="stl-model-img"
            loading="lazy"
          >
        {% else %}
          {{ 'collection-1' | placeholder_svg_tag: 'stl-model-img placeholder' }}
        {% endif %}
      </div>
    </div>

    <div class="stl-right">
      
      <div class="stl-header">
        <h2 class="stl-title">{{ section.settings.heading }}</h2>
        <div class="stl-separator" style="background-color: {{ section.settings.text_color }}"></div>
      </div>

      <div class="stl-slider-container">
        
        <button class="stl-nav-btn prev-btn" style="display: none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 18l-6-6 6-6"/></svg>
        </button>

        <div class="stl-slider-viewport">
          <div class="stl-slider-track">
            {% for block in section.blocks %}
              {% assign product = all_products[block.settings.product_handle] %}
              
              <div class="stl-card">
                <a href="{{ product.url }}" class="stl-link">
                  <div class="stl-card-img-box">
                    {% if block.settings.custom_image != blank %}
                      <img src="{{ block.settings.custom_image | image_url: width: 800 }}" alt="Product" class="stl-card-img">
                    {% elsif product.featured_image != blank %}
                      <img src="{{ product.featured_image | image_url: width: 800 }}" alt="{{ product.title }}" class="stl-card-img">
                    {% else %}
                      {{ 'product-1' | placeholder_svg_tag: 'stl-card-img placeholder' }}
                    {% endif %}
                  </div>
                  
                  <div class="stl-info">
                    <h3 class="stl-prod-title">{{ product.title }}</h3>
                    <p class="stl-prod-meta" style="color: {{ section.settings.text_color | color_modify: 'alpha', 0.6 }}">
                      {% if block.settings.custom_subtitle != blank %}
                        {{ block.settings.custom_subtitle }}
                      {% else %}
                        {{ product.type }}
                      {% endif %}
                    </p>
                    <div class="stl-dashed-line" style="border-color: {{ section.settings.text_color }}"></div>
                  </div>
                </a>
              </div>
            {% endfor %}
          </div>
        </div>

        <button class="stl-nav-btn next-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 18l6-6-6-6"/></svg>
        </button>

      </div>

      {% if section.settings.btn_label != blank %}
        <div class="stl-footer">
          <a href="{{ section.settings.btn_link }}" class="stl-view-all" style="border-color: {{ section.settings.text_color }}; color: {{ section.settings.text_color }};">
            {{ section.settings.btn_label }}
          </a>
        </div>
      {% endif %}

    </div>
  </div>
</div>

<style>
  /* Import Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500&family=Montserrat:wght@300;400;500&display=swap');

  .stl-section-wrapper {
    padding: 60px 0;
    overflow: hidden;
    width: 100%;
  }

  .stl-container {
    display: grid;
    grid-template-columns: 1.2fr 1fr; /* Image slightly wider like Loro Piana */
    max-width: 1600px;
    margin: 0 auto;
    align-items: center;
    gap: 0; /* Removed gap for seamless look */
    padding: 0 2%;
  }

  /* --- LEFT SIDE --- */
  .stl-left {
    padding: 0;
    opacity: 0; 
    transform: translateX(-50px);
  }

  .stl-image-frame {
    width: 100%;
    height: 850px;
    overflow: hidden;
  }

  .stl-model-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* --- RIGHT SIDE --- */
  .stl-right {
    padding: 0 80px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transform: translateX(50px);
    height: 100%;
    background-color: {{ section.settings.bg_color }}; /* Ensure white background covers grid area */
  }

  .stl-header { margin-bottom: 50px; }

  .stl-title {
    font-family: 'Cinzel', serif;
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 20px;
    letter-spacing: 1px;
  }

  .stl-separator {
    width: 1px;
    height: 20px;
    margin: 0 auto;
    opacity: 0.3;
  }

  /* --- SLIDER AREA --- */
  .stl-slider-container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    width: 100%;
    max-width: 450px; /* Limit width of product area */
    margin-bottom: 60px;
  }

  .stl-slider-viewport {
    width: 100%;
    overflow: hidden;
    padding: 20px 0;
  }

  .stl-slider-track {
    display: flex;
    width: 100%;
  }

  .stl-card {
    min-width: 100%;
    box-sizing: border-box;
    padding: 0 20px;
  }

  .stl-link { text-decoration: none; color: inherit; display: block; }

  .stl-card-img-box {
    width: 100%;
    height: 400px; /* Product Image Height */
    background: #f9f9f9; /* Very subtle grey for white products */
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .stl-card-img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* Contain ensures whole product is visible */
    mix-blend-mode: multiply; /* Helps transparent PNGs look better on off-white */
  }

  /* Typography */
  .stl-prod-title {
    font-family: 'Cinzel', serif;
    font-size: 1.4rem;
    margin: 10px 0;
    font-weight: 500;
  }

  .stl-prod-meta {
    font-family: 'Montserrat', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 1px;
    margin-bottom: 25px;
  }

  .stl-dashed-line {
    width: 40px;
    border-top: 1px dashed;
    margin: 0 auto;
    opacity: 0.4;
  }

  /* --- NAVIGATION BUTTONS (ICONS) --- */
  .stl-nav-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: #ffffff;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08); /* Soft luxury shadow */
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: absolute;
    top: 40%; /* Align with image center */
    z-index: 10;
    transition: all 0.3s ease;
    color: #000;
  }

  .stl-nav-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }

  .prev-btn { left: -20px; }
  .next-btn { right: -20px; }

  /* Footer Button */
  .stl-view-all {
    display: inline-block;
    padding: 15px 40px;
    border: 1px solid;
    text-transform: uppercase;
    font-family: 'Montserrat', sans-serif;
    font-size: 0.8rem;
    letter-spacing: 2px;
    text-decoration: none;
    transition: all 0.3s;
    background: transparent;
    color: black !important;
    border: 1px solid black !important;
}

  .stl-view-all:hover {
    background: #000;
    color: #fff !important;
  }

  /* RESPONSIVE */
  @media (max-width: 900px) {
    .stl-container {
      grid-template-columns: 1fr;
    }
    .stl-image-frame { height: 600px; }
    .stl-right { padding: 60px 20px; }
    .stl-nav-btn { width: 40px; height: 40px; }
    .prev-btn { left: 0; }
    .next-btn { right: 0; }
  }

  /* --- RESPONSIVE STYLES (Paste/Replace at the bottom of style tag) --- */

  /* Tablet / Vertical Stacking (Max-width: 1024px) */
  @media (max-width: 1024px) {
    .stl-section-wrapper {
      padding: 40px 0;
    }
    
    .stl-container {
      grid-template-columns: 1fr; /* Stack: Image Top, Slider Bottom */
      gap: 0;
    }

    .stl-left {
      width: 100%;
      padding: 0;
      /* Reset transform for better stacking */
      transform: none;
      opacity: 1; 
    }

    .stl-image-frame {
      height: 60vh; /* Dynamic height for tablets */
      max-height: 600px;
    }

    .stl-right {
      width: 100%;
      padding: 60px 20px;
      transform: none;
      opacity: 1;
    }
    
    .stl-slider-container {
      max-width: 100%; /* Use full width available */
    }
  }

  /* Mobile Phones (Max-width: 768px) */
  @media (max-width: 768px) {
    .stl-image-frame {
      height: 50vh; /* Takes half the screen on mobile */
      min-height: 400px;
    }

    .stl-title {
      font-size: 2rem;
      margin-bottom: 15px;
    }

    .stl-card-img-box {
      height: 320px; /* Smaller product image on phone */
      background: #fcfcfc;
    }

    /* Adjust Navigation Buttons for Touch */
    .stl-nav-btn {
      width: 40px;
      height: 40px;
      top: 35%; /* Move up slightly */
    }
    .prev-btn { left: 0; }
    .next-btn { right: 0; }
    
    .stl-card {
      padding: 0 5px; /* Less padding inside slider */
    }
  }

  /* Small Phones (Max-width: 480px) */
  @media (max-width: 480px) {
    .stl-right {
      padding: 40px 15px;
    }

    .stl-image-frame {
      height: 45vh;
      min-height: 300px;
    }

    .stl-title {
      font-size: 1.8rem;
    }

    .stl-prod-title {
      font-size: 1.2rem;
    }

    .stl-card-img-box {
      height: 250px; /* Even smaller for small screens */
    }

    .stl-view-all {
      padding: 12px 25px;
      font-size: 0.7rem;
      letter-spacing: 1.5px;
    }
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  gsap.registerPlugin(ScrollTrigger);

  // 1. SCROLL ANIMATION
  const tl = gsap.timeline({
    scrollTrigger: {
      trigger: ".stl-container",
      start: "top 75%",
      toggleActions: "play none none reverse"
    }
  });

  tl.to(".stl-left", { x: 0, opacity: 1, duration: 1, ease: "power3.out" })
    .to(".stl-right", { x: 0, opacity: 1, duration: 1, ease: "power3.out" }, "-=0.5");

  
  // 2. SLIDER LOGIC WITH SMART ICONS
  const track = document.querySelector('.stl-slider-track');
  const cards = document.querySelectorAll('.stl-card');
  const nextBtn = document.querySelector('.stl-nav-btn.next-btn');
  const prevBtn = document.querySelector('.stl-nav-btn.prev-btn');
  
  let currentIndex = 0;
  const totalSlides = cards.length;

  function updateSlider() {
    gsap.to(track, {
      xPercent: -100 * currentIndex,
      duration: 0.6,
      ease: "power2.inOut"
    });

    // ICON LOGIC:
    // 1. If at start (index 0), Hide Left Icon.
    // 2. If at end, Hide Right Icon.
    // 3. Otherwise show both.
    
    if (currentIndex === 0) {
      gsap.to(prevBtn, { autoAlpha: 0, display: 'none' }); // Hide Prev
      gsap.to(nextBtn, { autoAlpha: 1, display: 'flex' });
    } else if (currentIndex === totalSlides - 1) {
      gsap.to(prevBtn, { autoAlpha: 1, display: 'flex' });
      gsap.to(nextBtn, { autoAlpha: 0, display: 'none' }); // Hide Next
    } else {
      gsap.to(prevBtn, { autoAlpha: 1, display: 'flex' });
      gsap.to(nextBtn, { autoAlpha: 1, display: 'flex' });
    }
  }

  // Initial Check
  updateSlider();

  if(nextBtn) {
    nextBtn.addEventListener('click', () => {
      if (currentIndex < totalSlides - 1) {
        currentIndex++;
        updateSlider();
      }
    });
  }

  if(prevBtn) {
    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateSlider();
      }
    });
  }
});
</script>

{% schema %}
{
  "name": "Loro Piana Look (White)",
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#000000"
    },
    {
      "type": "image_picker",
      "id": "model_image",
      "label": "Model Image (Left)"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "The Look"
    },
    {
      "type": "text",
      "id": "btn_label",
      "label": "Button Label",
      "default": "View all looks"
    },
    {
      "type": "url",
      "id": "btn_link",
      "label": "Button Link"
    }
  ],
  "blocks": [
    {
      "type": "product_look",
      "name": "Product Slide",
      "settings": [
        {
          "type": "product",
          "id": "product_handle",
          "label": "Select Product"
        },
        {
          "type": "image_picker",
          "id": "custom_image",
          "label": "Manual Image Override (Optional)",
          "info": "Upload an image here to replace the default product image."
        },
        {
          "type": "text",
          "id": "custom_subtitle",
          "label": "Custom Subtitle",
          "placeholder": "Cashmere - Rain SystemÂ®"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Loro Piana Look (White)",
      "blocks": [
        { "type": "product_look" },
        { "type": "product_look" }
      ]
    }
  ]
}
{% endschema %}